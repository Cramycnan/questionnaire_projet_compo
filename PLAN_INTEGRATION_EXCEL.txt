================================================================================
PLAN D'INTÃ‰GRATION : SYNCHRONISATION HTML â†” EXCEL
================================================================================

Version : 1.0
Date : 14/11/2025
Option choisie : #4 - Synchronisation bidirectionnelle manuelle

================================================================================
OBJECTIF
================================================================================

Permettre un usage fluide du questionnaire client sur plusieurs sessions en
synchronisant les donnÃ©es entre :
- L'outil HTML (interface de saisie conviviale)
- Un fichier Excel (suivi, archivage, analyse)

Le client ou le compositeur peut :
1. Remplir le HTML â†’ Exporter vers Excel
2. Modifier dans Excel â†’ RÃ©importer dans HTML
3. Continuer Ã  remplir dans HTML â†’ Mettre Ã  jour Excel
4. GÃ©rer plusieurs projets dans des fichiers Excel sÃ©parÃ©s

================================================================================
FONCTIONNEMENT GLOBAL
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTML Form     â”‚
â”‚   (Interface)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Export Excel
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fichier .xlsx  â”‚
â”‚   (Stockage)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Import Excel
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTML Form     â”‚
â”‚   (Interface)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Flux de travail typique :
Session 1 (HTML) â†’ Export Excel â†’ Session 2 (Excel) â†’ Import HTML â†’
Session 3 (HTML) â†’ Export Excel (mise Ã  jour)

================================================================================
Ã‰TAPE 1 : PRÃ‰PARATION (PrÃ©requis techniques)
================================================================================

1.1. Ajouter la librairie SheetJS
----------------------------------
Fichier : composer-client-checklist (1).html
Localisation : Avant la balise </head> (ligne 336)

Action :
Ajouter cette ligne dans le <head> :
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

Pourquoi SheetJS ?
- Librairie JavaScript standard pour Excel
- Gratuite et open-source (Apache 2.0)
- Supporte .xlsx (format Excel moderne)
- Fonctionne cÃ´tÃ© navigateur (pas de serveur)
- Documentation : https://docs.sheetjs.com/

Alternatives envisagÃ©es :
- ExcelJS : Plus complet mais plus lourd
- PapaParse : CSV seulement (insuffisant)
- SheetJS reste le meilleur choix qualitÃ©/simplicitÃ©


1.2. DÃ©finir la structure des donnÃ©es Excel
--------------------------------------------
Format choisi : Un fichier Excel par projet avec 5 onglets

Onglet 1 : "MÃ©tadonnÃ©es"
â”œâ”€ Informations de synchronisation
â”œâ”€ Date d'export
â”œâ”€ Version du questionnaire
â””â”€ DerniÃ¨re modification

Onglet 2 : "Infos_Projet"
â”œâ”€ Nom du client
â”œâ”€ Nom du projet
â”œâ”€ Date premier contact
â””â”€ Personne de contact

Onglet 3 : "Questionnaire"
â”œâ”€ Colonne A : Section
â”œâ”€ Colonne B : Question (label)
â”œâ”€ Colonne C : RÃ©ponse (valeur)
â”œâ”€ Colonne D : Identifiant technique (data-field)
â”œâ”€ Colonne E : Date de derniÃ¨re modification
â””â”€ Colonne F : Statut/Notes

Onglet 4 : "Progression"
â”œâ”€ Tableau de bord avec formules Excel
â”œâ”€ Progression par section
â”œâ”€ Progression globale
â””â”€ Statistiques (champs remplis/vides)

Onglet 5 : "Historique"
â”œâ”€ Journal des modifications
â”œâ”€ Date/heure
â”œâ”€ Champ modifiÃ©
â””â”€ Ancienne/Nouvelle valeur


1.3. Mapping des donnÃ©es HTML â†’ Excel
--------------------------------------
Correspondance entre les champs HTML et les colonnes Excel :

HTML (attribut data-field) â†’ Excel (colonne "Identifiant")
Exemple :
    <textarea data-field="project-type"> â†’ Ligne avec ID "project-type"
    <textarea data-field="budget-total"> â†’ Ligne avec ID "budget-total"

Champs projet (IDs spÃ©ciaux) :
    #client-name     â†’ "client-name"
    #project-name    â†’ "project-name"
    #contact-date    â†’ "contact-date"
    #contact-person  â†’ "contact-person"

Total : 4 champs projet + 42 champs questionnaire = 46 lignes dans Excel

================================================================================
Ã‰TAPE 2 : DÃ‰VELOPPEMENT EXPORT HTML â†’ EXCEL
================================================================================

2.1. CrÃ©er la fonction principale : exportToExcel()
----------------------------------------------------
Fichier : Section <script> (aprÃ¨s ligne 901)

Fonction Ã  crÃ©er : exportToExcel()
Objectif : GÃ©nÃ©rer un fichier .xlsx Ã  partir des donnÃ©es HTML

Pseudo-code :
```
function exportToExcel() {
    1. RÃ©cupÃ©rer toutes les donnÃ©es du formulaire HTML
    2. CrÃ©er un workbook (fichier Excel) vide
    3. CrÃ©er l'onglet "MÃ©tadonnÃ©es"
    4. CrÃ©er l'onglet "Infos_Projet"
    5. CrÃ©er l'onglet "Questionnaire"
    6. CrÃ©er l'onglet "Progression"
    7. CrÃ©er l'onglet "Historique"
    8. Appliquer la mise en forme
    9. TÃ©lÃ©charger le fichier .xlsx
}
```

DÃ©tails par Ã©tape :

2.1.1. RÃ©cupÃ©ration des donnÃ©es
--------------------------------
```javascript
const projectData = {
    clientName: document.getElementById('client-name').value,
    projectName: document.getElementById('project-name').value,
    contactDate: document.getElementById('contact-date').value,
    contactPerson: document.getElementById('contact-person').value
};

const questionsData = [];
document.querySelectorAll('.question-input').forEach(input => {
    const questionItem = input.closest('.question-item');
    const section = questionItem.closest('.section').querySelector('h2').textContent;
    const label = questionItem.querySelector('.question-label').textContent;

    questionsData.push({
        section: section,
        question: label,
        answer: input.value,
        fieldId: input.dataset.field,
        lastModified: localStorage.getItem(`lastMod_${input.dataset.field}`) || '',
        status: ''
    });
});
```

2.1.2. CrÃ©ation de l'onglet "MÃ©tadonnÃ©es"
------------------------------------------
Structure :
Row 1: ["Champ", "Valeur"]
Row 2: ["Date d'export", "2025-11-14 15:30:00"]
Row 3: ["Version questionnaire", "1.0"]
Row 4: ["Nom du fichier HTML", "composer-client-checklist.html"]
Row 5: ["Nombre total de champs", "46"]
Row 6: ["Champs remplis", "28"]

Code :
```javascript
const metaData = [
    ["Champ", "Valeur"],
    ["Date d'export", new Date().toLocaleString('fr-FR')],
    ["Version questionnaire", "1.0"],
    ["Nom du fichier HTML", "composer-client-checklist (1).html"],
    ["Nombre total de champs", "46"],
    ["Champs remplis", filledCount]
];

const wsMetadata = XLSX.utils.aoa_to_sheet(metaData);
```

2.1.3. CrÃ©ation de l'onglet "Infos_Projet"
-------------------------------------------
Structure :
Row 1: ["Champ", "Valeur"]
Row 2: ["Nom du client / SociÃ©tÃ©", "Productions XYZ"]
Row 3: ["Nom du projet", "Court-mÃ©trage ABC"]
Row 4: ["Date du premier contact", "2025-11-14"]
Row 5: ["Personne de contact", "Jean Dupont"]

Code :
```javascript
const projectInfo = [
    ["Champ", "Valeur"],
    ["Nom du client / SociÃ©tÃ©", projectData.clientName],
    ["Nom du projet", projectData.projectName],
    ["Date du premier contact", projectData.contactDate],
    ["Personne de contact", projectData.contactPerson]
];

const wsProject = XLSX.utils.aoa_to_sheet(projectInfo);
```

2.1.4. CrÃ©ation de l'onglet "Questionnaire"
--------------------------------------------
Structure :
Row 1: Headers
    ["Section", "Question", "RÃ©ponse", "ID Technique", "Date Modif", "Statut"]

Row 2+: DonnÃ©es
    ["ğŸ“‹ Informations gÃ©nÃ©rales", "Type de projet", "Fiction 12min", "project-type", "2025-11-14", ""]

Code :
```javascript
const questionnaireData = [
    ["Section", "Question", "RÃ©ponse", "ID Technique", "Date Modif", "Statut"]
];

questionsData.forEach(q => {
    questionnaireData.push([
        q.section,
        q.question,
        q.answer,
        q.fieldId,
        q.lastModified,
        q.status
    ]);
});

const wsQuestionnaire = XLSX.utils.aoa_to_sheet(questionnaireData);
```

2.1.5. CrÃ©ation de l'onglet "Progression"
------------------------------------------
Structure avec formules Excel :
Row 1: ["Section", "ComplÃ©tÃ©s", "Total", "Pourcentage"]
Row 2: ["Infos gÃ©nÃ©rales", "5", "5", "=B2/C2"]
Row 3: ["Budget", "3", "5", "=B3/C3"]
...
Row 9: ["TOTAL", "=SUM(B2:B8)", "=SUM(C2:C8)", "=B9/C9"]

Code :
```javascript
// Calculer la progression par section
const sections = [
    "ğŸ“‹ Informations gÃ©nÃ©rales sur le projet",
    "ğŸ’° Aspects financiers et budget",
    "ğŸ¼ Besoins musicaux spÃ©cifiques",
    "ğŸ“… Planning et deadlines",
    "ğŸ§ Aspects techniques et production",
    "âš–ï¸ Droits et aspects juridiques",
    "ğŸ¤ ModalitÃ©s de collaboration",
    "â• Ã‰lÃ©ments complÃ©mentaires"
];

const progressData = [["Section", "ComplÃ©tÃ©s", "Total", "Pourcentage"]];

sections.forEach(sectionName => {
    const sectionQuestions = questionsData.filter(q => q.section === sectionName);
    const filled = sectionQuestions.filter(q => q.answer.trim() !== '').length;
    const total = sectionQuestions.length;

    progressData.push([
        sectionName,
        filled,
        total,
        total > 0 ? (filled / total) : 0
    ]);
});

const wsProgress = XLSX.utils.aoa_to_sheet(progressData);
```

2.1.6. CrÃ©ation de l'onglet "Historique"
-----------------------------------------
Structure :
Row 1: ["Date/Heure", "Champ", "Action", "Ancienne valeur", "Nouvelle valeur"]
Row 2+: Vide pour l'instant (sera rempli lors des imports)

Note : L'historique sera construit progressivement lors des imports Excel

2.1.7. Mise en forme Excel
---------------------------
Appliquer des styles pour rendre le fichier professionnel :

- En-tÃªtes en gras
- Lignes alternÃ©es (zebra striping)
- Colonnes auto-largeur
- Sections importantes en couleur (Budget, Droits)

Code exemple :
```javascript
// Largeur des colonnes
wsQuestionnaire['!cols'] = [
    { wch: 30 },  // Section
    { wch: 50 },  // Question
    { wch: 60 },  // RÃ©ponse
    { wch: 20 },  // ID
    { wch: 15 },  // Date
    { wch: 15 }   // Statut
];

// Style des en-tÃªtes (nÃ©cessite xlsx-style ou autre extension)
// Alternative : utiliser le formatage conditionnel d'Excel aprÃ¨s ouverture
```

2.1.8. GÃ©nÃ©ration et tÃ©lÃ©chargement du fichier
-----------------------------------------------
```javascript
const workbook = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(workbook, wsMetadata, "MÃ©tadonnÃ©es");
XLSX.utils.book_append_sheet(workbook, wsProject, "Infos_Projet");
XLSX.utils.book_append_sheet(workbook, wsQuestionnaire, "Questionnaire");
XLSX.utils.book_append_sheet(workbook, wsProgress, "Progression");
XLSX.utils.book_append_sheet(workbook, wsHistorique, "Historique");

// GÃ©nÃ©rer le nom du fichier
const clientName = projectData.clientName.replace(/\s+/g, '-') || 'client';
const projectName = projectData.projectName.replace(/\s+/g, '-') || 'projet';
const date = new Date().toISOString().split('T')[0];
const fileName = `questionnaire-${clientName}-${projectName}-${date}.xlsx`;

// TÃ©lÃ©charger
XLSX.writeFile(workbook, fileName);
```


2.2. Ajouter le bouton dans l'interface
----------------------------------------
Fichier : HTML, section .actions (ligne 641)

Modifier :
```html
<button class="btn-export" onclick="exportData()">ğŸ“„ Exporter PDF</button>
```

En :
```html
<button class="btn-export" onclick="exportData()">ğŸ“„ Exporter TXT</button>
<button class="btn-export" onclick="exportToExcel()">ğŸ“Š Exporter Excel</button>
```

Style CSS Ã  ajouter (optionnel, pour diffÃ©rencier les boutons) :
```css
.btn-export-excel {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
}
```


2.3. Gestion de l'horodatage
-----------------------------
Pour suivre quand chaque champ a Ã©tÃ© modifiÃ©, ajouter un systÃ¨me de timestamps.

Modifier la fonction autoSave() (ligne 688) :
```javascript
function autoSave() {
    const data = {
        clientName: document.getElementById('client-name').value,
        projectName: document.getElementById('project-name').value,
        contactDate: document.getElementById('contact-date').value,
        contactPerson: document.getElementById('contact-person').value,
        fields: {},
        lastModified: {}  // NOUVEAU
    };

    const now = new Date().toISOString();

    document.querySelectorAll('.question-input').forEach(input => {
        data.fields[input.dataset.field] = input.value;

        // NOUVEAU : Enregistrer la date de modification
        if (input.value.trim() !== '') {
            const oldValue = localStorage.getItem(`field_${input.dataset.field}`) || '';
            if (oldValue !== input.value) {
                data.lastModified[input.dataset.field] = now;
                localStorage.setItem(`lastMod_${input.dataset.field}`, now);
            }
        }
    });

    localStorage.setItem('composerClientData', JSON.stringify(data));
    // ... reste du code
}
```

================================================================================
Ã‰TAPE 3 : DÃ‰VELOPPEMENT IMPORT EXCEL â†’ HTML
================================================================================

3.1. CrÃ©er la fonction principale : importFromExcel()
------------------------------------------------------
Objectif : Lire un fichier .xlsx et remplir le formulaire HTML

Pseudo-code :
```
function importFromExcel() {
    1. Ouvrir un sÃ©lecteur de fichier (.xlsx)
    2. Lire le fichier avec SheetJS
    3. Parser l'onglet "Infos_Projet"
    4. Parser l'onglet "Questionnaire"
    5. DÃ©tecter les conflits (champs dÃ©jÃ  remplis)
    6. Proposer les options de fusion
    7. Remplir le formulaire HTML
    8. Mettre Ã  jour localStorage
    9. Mettre Ã  jour la progression
}
```


3.2. Lecture du fichier Excel
------------------------------
```javascript
function importFromExcel() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.xlsx';

    input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();

        reader.onload = function(event) {
            try {
                // Lire le fichier Excel
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });

                // Parser les donnÃ©es
                parseExcelData(workbook);

            } catch (error) {
                alert('Erreur lors de la lecture du fichier Excel : ' + error.message);
            }
        };

        reader.readAsArrayBuffer(file);
    };

    input.click();
}
```


3.3. Parsing des donnÃ©es Excel
-------------------------------
```javascript
function parseExcelData(workbook) {
    // 1. Lire l'onglet "Infos_Projet"
    const wsProject = workbook.Sheets["Infos_Projet"];
    const projectData = XLSX.utils.sheet_to_json(wsProject, { header: 1 });

    // projectData = [
    //   ["Champ", "Valeur"],
    //   ["Nom du client / SociÃ©tÃ©", "Productions XYZ"],
    //   ...
    // ]

    const projectInfo = {};
    for (let i = 1; i < projectData.length; i++) {
        const [field, value] = projectData[i];
        if (field && value) {
            projectInfo[field] = value;
        }
    }

    // 2. Lire l'onglet "Questionnaire"
    const wsQuestionnaire = workbook.Sheets["Questionnaire"];
    const questionnaireData = XLSX.utils.sheet_to_json(wsQuestionnaire, { header: 1 });

    // questionnaireData = [
    //   ["Section", "Question", "RÃ©ponse", "ID Technique", "Date Modif", "Statut"],
    //   ["ğŸ“‹ Infos gÃ©nÃ©rales", "Type de projet", "Fiction", "project-type", "...", ""],
    //   ...
    // ]

    const questionsMap = {};
    for (let i = 1; i < questionnaireData.length; i++) {
        const [section, question, answer, fieldId, dateModif, status] = questionnaireData[i];
        if (fieldId) {
            questionsMap[fieldId] = {
                answer: answer || '',
                dateModif: dateModif,
                status: status
            };
        }
    }

    // 3. DÃ©tecter les conflits et appliquer
    applyImportedData(projectInfo, questionsMap);
}
```


3.4. DÃ©tection des conflits et fusion
--------------------------------------
```javascript
function applyImportedData(projectInfo, questionsMap) {
    // Compter les conflits (champs remplis dans HTML ET dans Excel)
    let conflicts = 0;
    const allInputs = document.querySelectorAll('.question-input');

    allInputs.forEach(input => {
        const fieldId = input.dataset.field;
        if (questionsMap[fieldId] &&
            input.value.trim() !== '' &&
            questionsMap[fieldId].answer !== input.value) {
            conflicts++;
        }
    });

    // Si conflits dÃ©tectÃ©s, demander Ã  l'utilisateur
    let importMode = 'overwrite'; // Par dÃ©faut : Ã©craser

    if (conflicts > 0) {
        const choice = confirm(
            `${conflicts} champ(s) sont dÃ©jÃ  remplis dans le formulaire.\n\n` +
            `OK : Remplacer tous les champs par les valeurs Excel\n` +
            `Annuler : Importer uniquement les champs vides`
        );

        importMode = choice ? 'overwrite' : 'fillEmpty';
    }

    // Appliquer l'import selon le mode choisi
    applyImport(projectInfo, questionsMap, importMode);
}


function applyImport(projectInfo, questionsMap, mode) {
    // Remplir les infos projet
    const mapping = {
        "Nom du client / SociÃ©tÃ©": "client-name",
        "Nom du projet": "project-name",
        "Date du premier contact": "contact-date",
        "Personne de contact": "contact-person"
    };

    Object.entries(mapping).forEach(([excelField, htmlId]) => {
        const value = projectInfo[excelField];
        if (value) {
            const input = document.getElementById(htmlId);
            if (mode === 'overwrite' || input.value.trim() === '') {
                input.value = value;
            }
        }
    });

    // Remplir les questions
    document.querySelectorAll('.question-input').forEach(input => {
        const fieldId = input.dataset.field;
        const excelData = questionsMap[fieldId];

        if (excelData && excelData.answer) {
            if (mode === 'overwrite') {
                // Remplacer dans tous les cas
                input.value = excelData.answer;
            } else if (mode === 'fillEmpty') {
                // Remplir seulement si vide
                if (input.value.trim() === '') {
                    input.value = excelData.answer;
                }
            }

            // Enregistrer la date de modification
            if (excelData.dateModif) {
                localStorage.setItem(`lastMod_${fieldId}`, excelData.dateModif);
            }
        }
    });

    // Sauvegarder et mettre Ã  jour
    autoSave();
    updateProgress();

    alert('Import Excel terminÃ© avec succÃ¨s !');
}
```


3.5. Ajouter le bouton d'import
--------------------------------
Modifier le bouton "Importer" existant (ligne 644) :

De :
```html
<button class="btn-import" onclick="importData()">ğŸ“¥ Importer</button>
```

Ã€ :
```html
<button class="btn-import" onclick="importData()">ğŸ“¥ Importer JSON</button>
<button class="btn-import" onclick="importFromExcel()">ğŸ“¥ Importer Excel</button>
```

Ou crÃ©er un bouton combinÃ© avec menu :
```html
<div class="dropdown">
    <button class="btn-import">ğŸ“¥ Importer â–¼</button>
    <div class="dropdown-content">
        <a onclick="importData()">JSON (.json)</a>
        <a onclick="importFromExcel()">Excel (.xlsx)</a>
    </div>
</div>
```

================================================================================
Ã‰TAPE 4 : AMÃ‰LIORATIONS POUR USAGE MULTI-SESSIONS
================================================================================

4.1. Horodatage visible dans l'interface
-----------------------------------------
Ajouter un indicateur visuel de la derniÃ¨re modification de chaque champ.

Modifier la fonction updateProgress() (ligne 661) pour afficher les dates :
```javascript
allInputs.forEach(input => {
    if (input.value.trim() !== '') {
        input.classList.add('filled');

        // NOUVEAU : Afficher la date de modification
        const fieldId = input.dataset.field || input.id;
        const lastMod = localStorage.getItem(`lastMod_${fieldId}`);

        if (lastMod) {
            const date = new Date(lastMod);
            const dateStr = date.toLocaleDateString('fr-FR');

            // Ajouter un badge de date
            let badge = input.parentElement.querySelector('.date-badge');
            if (!badge) {
                badge = document.createElement('span');
                badge.className = 'date-badge';
                input.parentElement.appendChild(badge);
            }
            badge.textContent = `ModifiÃ© le ${dateStr}`;
        }

        if (input.parentElement.classList.contains('question-item')) {
            input.parentElement.classList.add('filled');
        }
    }
});
```

Ajouter le style CSS pour le badge (aprÃ¨s ligne 336) :
```css
.date-badge {
    font-size: 0.75em;
    color: #718096;
    font-style: italic;
    display: block;
    margin-top: 5px;
}
```


4.2. Gestion de l'historique des modifications
-----------------------------------------------
CrÃ©er un journal des modifications lors des imports Excel.

Nouvelle fonction :
```javascript
function addToHistory(fieldId, oldValue, newValue, source) {
    const history = JSON.parse(localStorage.getItem('modificationHistory') || '[]');

    history.push({
        date: new Date().toISOString(),
        fieldId: fieldId,
        oldValue: oldValue,
        newValue: newValue,
        source: source  // 'html', 'excel', 'json'
    });

    // Garder seulement les 100 derniÃ¨res modifications
    if (history.length > 100) {
        history.shift();
    }

    localStorage.setItem('modificationHistory', JSON.stringify(history));
}
```

Modifier applyImport() pour logger les changements :
```javascript
// Avant de changer la valeur :
const oldValue = input.value;
input.value = excelData.answer;
addToHistory(fieldId, oldValue, excelData.answer, 'excel');
```

Exporter cet historique dans l'onglet "Historique" de Excel :
```javascript
function getHistoryForExcel() {
    const history = JSON.parse(localStorage.getItem('modificationHistory') || '[]');
    const historyData = [["Date/Heure", "Champ", "Action", "Ancienne valeur", "Nouvelle valeur", "Source"]];

    history.forEach(h => {
        const date = new Date(h.date).toLocaleString('fr-FR');
        const fieldLabel = document.querySelector(`[data-field="${h.fieldId}"]`)
            ?.closest('.question-item')
            ?.querySelector('.question-label')
            ?.textContent || h.fieldId;

        historyData.push([
            date,
            fieldLabel,
            h.oldValue ? "Modification" : "Ajout",
            h.oldValue,
            h.newValue,
            h.source.toUpperCase()
        ]);
    });

    return historyData;
}
```


4.3. Mode "AperÃ§u avant import"
--------------------------------
Afficher un rÃ©sumÃ© des changements avant de les appliquer.

```javascript
function showImportPreview(projectInfo, questionsMap) {
    const changes = [];

    // VÃ©rifier les infos projet
    const mapping = {
        "Nom du client / SociÃ©tÃ©": "client-name",
        "Nom du projet": "project-name",
        "Date du premier contact": "contact-date",
        "Personne de contact": "contact-person"
    };

    Object.entries(mapping).forEach(([excelField, htmlId]) => {
        const newValue = projectInfo[excelField];
        const currentValue = document.getElementById(htmlId).value;

        if (newValue && newValue !== currentValue) {
            changes.push({
                field: excelField,
                current: currentValue || '(vide)',
                new: newValue,
                type: currentValue ? 'modification' : 'ajout'
            });
        }
    });

    // VÃ©rifier les questions
    document.querySelectorAll('.question-input').forEach(input => {
        const fieldId = input.dataset.field;
        const excelData = questionsMap[fieldId];

        if (excelData && excelData.answer && excelData.answer !== input.value) {
            const label = input.closest('.question-item')
                .querySelector('.question-label').textContent;

            changes.push({
                field: label,
                current: input.value || '(vide)',
                new: excelData.answer,
                type: input.value ? 'modification' : 'ajout'
            });
        }
    });

    // Afficher le rÃ©sumÃ© dans un modal ou console
    if (changes.length === 0) {
        alert('Aucune modification dÃ©tectÃ©e. Le formulaire est dÃ©jÃ  Ã  jour.');
        return false;
    }

    let summary = `=== APERÃ‡U DE L'IMPORT ===\n\n`;
    summary += `${changes.length} modification(s) dÃ©tectÃ©e(s):\n\n`;

    changes.forEach((c, i) => {
        summary += `${i + 1}. ${c.field}\n`;
        summary += `   Actuel : ${c.current.substring(0, 50)}...\n`;
        summary += `   Nouveau : ${c.new.substring(0, 50)}...\n\n`;
    });

    return confirm(summary + '\nVoulez-vous appliquer ces modifications ?');
}
```

IntÃ©grer dans parseExcelData() :
```javascript
function parseExcelData(workbook) {
    // ... parsing ...

    // Afficher l'aperÃ§u
    const shouldProceed = showImportPreview(projectInfo, questionsMap);

    if (shouldProceed) {
        applyImportedData(projectInfo, questionsMap);
    } else {
        alert('Import annulÃ©.');
    }
}
```


4.4. Sauvegarde automatique du backup Excel
--------------------------------------------
Exporter automatiquement un Excel Ã  chaque session.

Ajouter dans la fonction DOMContentLoaded (ligne 831) :
```javascript
// Auto-export Excel toutes les 30 minutes si modifications
let lastExcelExport = localStorage.getItem('lastExcelExport');
setInterval(() => {
    const now = Date.now();
    const last = parseInt(lastExcelExport) || 0;

    if (now - last > 30 * 60 * 1000) { // 30 minutes
        // VÃ©rifier s'il y a eu des modifications
        const lastSave = localStorage.getItem('lastSaveTimestamp');
        if (lastSave && parseInt(lastSave) > last) {
            exportToExcel();
            localStorage.setItem('lastExcelExport', now.toString());
        }
    }
}, 60000); // VÃ©rifier toutes les minutes
```

================================================================================
Ã‰TAPE 5 : TESTS ET VALIDATION
================================================================================

5.1. ScÃ©narios de test Ã  valider
---------------------------------

Test 1 : Export basique
â–¡ Remplir 10 champs dans le HTML
â–¡ Cliquer sur "Exporter Excel"
â–¡ VÃ©rifier que le fichier .xlsx se tÃ©lÃ©charge
â–¡ Ouvrir dans Excel
â–¡ VÃ©rifier les 5 onglets sont prÃ©sents
â–¡ VÃ©rifier que les 10 champs apparaissent dans "Questionnaire"
â–¡ VÃ©rifier que la progression affiche "10/46"

Test 2 : Import basique
â–¡ Modifier 5 champs dans le fichier Excel
â–¡ Sauvegarder l'Excel
â–¡ Retourner au HTML
â–¡ Cliquer sur "Importer Excel"
â–¡ SÃ©lectionner le fichier
â–¡ VÃ©rifier que les 5 modifications apparaissent dans le HTML
â–¡ VÃ©rifier que la progression est mise Ã  jour

Test 3 : Gestion des conflits (mode Ã©craser)
â–¡ Remplir le champ "Budget" avec "3000â‚¬" dans le HTML
â–¡ Dans Excel, mettre "Budget" Ã  "5000â‚¬"
â–¡ Importer l'Excel
â–¡ Choisir "OK" (remplacer)
â–¡ VÃ©rifier que "Budget" affiche "5000â‚¬" dans le HTML

Test 4 : Gestion des conflits (mode remplir vides)
â–¡ Remplir le champ "Budget" avec "3000â‚¬" dans le HTML
â–¡ Laisser "Planning" vide dans le HTML
â–¡ Dans Excel, mettre "Budget" Ã  "5000â‚¬" et "Planning" Ã  "01/03/2026"
â–¡ Importer l'Excel
â–¡ Choisir "Annuler" (remplir uniquement les vides)
â–¡ VÃ©rifier que "Budget" reste Ã  "3000â‚¬"
â–¡ VÃ©rifier que "Planning" est maintenant "01/03/2026"

Test 5 : Multi-sessions
â–¡ Session 1 : Remplir 15 champs â†’ Export Excel
â–¡ Fermer le navigateur
â–¡ Session 2 : Rouvrir HTML â†’ VÃ©rifier les 15 champs prÃ©sents
â–¡ Ajouter 10 champs â†’ Export Excel
â–¡ Session 3 : Modifier 5 champs dans Excel
â–¡ Importer dans HTML â†’ VÃ©rifier les modifications

Test 6 : Horodatage
â–¡ Remplir un champ
â–¡ VÃ©rifier qu'un badge "ModifiÃ© le XX/XX/XXXX" apparaÃ®t
â–¡ Exporter Excel
â–¡ VÃ©rifier que la colonne "Date Modif" contient la date
â–¡ Modifier le champ dans Excel avec une nouvelle date
â–¡ Importer
â–¡ VÃ©rifier que la nouvelle date apparaÃ®t

Test 7 : Historique
â–¡ Remplir un champ avec "Valeur A"
â–¡ Modifier avec "Valeur B"
â–¡ Importer un Excel avec "Valeur C"
â–¡ Exporter Excel
â–¡ VÃ©rifier l'onglet "Historique" contient les 3 modifications

Test 8 : Noms de fichiers
â–¡ Projet : "Court-mÃ©trage ABC"
â–¡ Client : "Productions XYZ"
â–¡ Export Excel
â–¡ VÃ©rifier nom : "questionnaire-Productions-XYZ-Court-mÃ©trage-ABC-2025-11-14.xlsx"

Test 9 : CaractÃ¨res spÃ©ciaux
â–¡ Remplir un champ avec : "Budget: 5000â‚¬ (dont 30% d'acompte)"
â–¡ Exporter Excel
â–¡ VÃ©rifier que les caractÃ¨res spÃ©ciaux (â‚¬, %) sont correctement affichÃ©s
â–¡ Importer
â–¡ VÃ©rifier l'intÃ©gritÃ©

Test 10 : Fichier vide
â–¡ CrÃ©er un nouveau formulaire vide
â–¡ Exporter Excel
â–¡ VÃ©rifier que l'Excel se gÃ©nÃ¨re sans erreur
â–¡ VÃ©rifier que toutes les lignes ont des rÃ©ponses vides


5.2. Checklist de validation finale
------------------------------------
Avant de considÃ©rer la fonctionnalitÃ© terminÃ©e :

FonctionnalitÃ©s :
â–¡ Export HTML â†’ Excel fonctionne
â–¡ Import Excel â†’ HTML fonctionne
â–¡ Gestion des conflits (2 modes) fonctionne
â–¡ Horodatage visible et fonctionnel
â–¡ Historique des modifications enregistrÃ©
â–¡ Fichier Excel bien formatÃ© (5 onglets)
â–¡ Noms de fichiers corrects et lisibles

QualitÃ© :
â–¡ Aucune erreur JavaScript dans la console
â–¡ Messages d'erreur clairs pour l'utilisateur
â–¡ Gestion des cas limites (fichier corrompu, etc.)
â–¡ Performance acceptable (< 2s pour export/import)

Documentation :
â–¡ Instructions utilisateur dans CLAUDE.md mises Ã  jour
â–¡ Exemples de workflow ajoutÃ©s
â–¡ Capture d'Ã©cran du fichier Excel dans README (optionnel)

CompatibilitÃ© :
â–¡ TestÃ© sur Chrome/Edge
â–¡ TestÃ© sur Firefox
â–¡ TestÃ© sur Safari (si macOS disponible)
â–¡ Fichier Excel ouvrable dans Microsoft Excel
â–¡ Fichier Excel ouvrable dans LibreOffice Calc
â–¡ Fichier Excel ouvrable dans Google Sheets

================================================================================
Ã‰TAPE 6 : DOCUMENTATION UTILISATEUR
================================================================================

6.1. Mettre Ã  jour CLAUDE.md
-----------------------------
Ajouter une section "Export/Import Excel" avec :

- Description de la fonctionnalitÃ©
- Workflow recommandÃ©
- Structure du fichier Excel
- Cas d'usage typiques
- RÃ©solution des problÃ¨mes courants

Exemple de contenu :
```markdown
## Export/Import Excel

### FonctionnalitÃ©
Le questionnaire peut Ãªtre synchronisÃ© avec un fichier Excel pour :
- Archivage et suivi multi-projets
- Modification dans Excel (plus pratique pour certains)
- Partage avec le client pour complÃ©tion
- Analyse des donnÃ©es (formules Excel, graphiques)

### Workflow multi-sessions
1. Session 1 (HTML) : Remplir pendant l'appel â†’ Exporter Excel
2. Session 2 (Excel) : ComplÃ©ter/modifier dans Excel
3. Session 3 (HTML) : Importer Excel â†’ ComplÃ©ter â†’ Exporter Excel
4. RÃ©pÃ©ter selon les besoins

### Structure du fichier Excel
- **MÃ©tadonnÃ©es** : Info sur l'export (date, version)
- **Infos_Projet** : DonnÃ©es du projet (client, nom, contact)
- **Questionnaire** : Toutes les questions avec rÃ©ponses
- **Progression** : Tableau de bord automatique
- **Historique** : Journal des modifications

### Gestion des conflits
Lors de l'import, si des champs sont dÃ©jÃ  remplis :
- Bouton "OK" : Remplacer tous les champs
- Bouton "Annuler" : Remplir uniquement les champs vides

### Conseils
- Exporter Excel rÃ©guliÃ¨rement pour backup
- Nommer les fichiers avec dates : projet-2025-11-14.xlsx
- Un fichier Excel par projet recommandÃ©
- PossibilitÃ© de consolider plusieurs projets dans un Excel unique
```


6.2. CrÃ©er un guide visuel (optionnel)
---------------------------------------
CrÃ©er un fichier GUIDE_EXCEL.md avec des captures d'Ã©cran montrant :
- Le bouton "Exporter Excel"
- L'apparence du fichier Excel gÃ©nÃ©rÃ©
- Le processus d'import
- La gestion des conflits

================================================================================
Ã‰TAPE 7 : OPTIMISATIONS ET BONUS
================================================================================

7.1. Validation Excel stricte
------------------------------
Ajouter une validation lors de l'import pour s'assurer que le fichier
provient bien du questionnaire et n'a pas Ã©tÃ© corrompu.

```javascript
function validateExcelFile(workbook) {
    // VÃ©rifier la prÃ©sence des onglets requis
    const requiredSheets = ["MÃ©tadonnÃ©es", "Infos_Projet", "Questionnaire"];

    for (const sheetName of requiredSheets) {
        if (!workbook.Sheets[sheetName]) {
            throw new Error(`Onglet manquant : ${sheetName}`);
        }
    }

    // VÃ©rifier la version dans MÃ©tadonnÃ©es
    const wsMeta = workbook.Sheets["MÃ©tadonnÃ©es"];
    const metaData = XLSX.utils.sheet_to_json(wsMeta, { header: 1 });

    // Chercher la ligne "Version questionnaire"
    const versionRow = metaData.find(row => row[0] === "Version questionnaire");
    if (!versionRow) {
        throw new Error("Version du questionnaire non trouvÃ©e");
    }

    const version = versionRow[1];
    if (version !== "1.0") {
        const proceed = confirm(
            `Ce fichier a Ã©tÃ© crÃ©Ã© avec une version diffÃ©rente (${version}).\n` +
            `Voulez-vous continuer l'import ?`
        );
        if (!proceed) throw new Error("Import annulÃ©");
    }

    return true;
}
```

IntÃ©grer dans importFromExcel() :
```javascript
try {
    const workbook = XLSX.read(data, { type: 'array' });
    validateExcelFile(workbook);
    parseExcelData(workbook);
} catch (error) {
    alert('Erreur : ' + error.message);
}
```


7.2. Formatage conditionnel Excel
----------------------------------
Ajouter des couleurs automatiques dans Excel selon l'Ã©tat des champs.

Note : SheetJS basique ne supporte pas le formatage conditionnel avancÃ©.
Solutions :
a) Utiliser xlsx-style (fork de SheetJS avec styles)
b) Appliquer les couleurs cÃ´tÃ© Excel aprÃ¨s ouverture (macro VBA)
c) Utiliser des couleurs de fond basiques (supportÃ© par SheetJS)

Option C (simple) :
```javascript
// Dans exportToExcel(), aprÃ¨s crÃ©ation du worksheet
const range = XLSX.utils.decode_range(wsQuestionnaire['!ref']);

for (let row = 1; row <= range.e.r; row++) {
    const cellAnswer = XLSX.utils.encode_cell({ r: row, c: 2 }); // Colonne C (RÃ©ponse)

    if (wsQuestionnaire[cellAnswer] && wsQuestionnaire[cellAnswer].v) {
        // Si rÃ©ponse remplie, fond vert clair
        wsQuestionnaire[cellAnswer].s = {
            fill: { fgColor: { rgb: "C6EFCE" } }
        };
    } else {
        // Si vide, fond orange clair
        wsQuestionnaire[cellAnswer].s = {
            fill: { fgColor: { rgb: "FFEB9C" } }
        };
    }
}
```


7.3. Templates Excel prÃ©dÃ©finis
--------------------------------
CrÃ©er un template Excel vide que l'utilisateur peut tÃ©lÃ©charger et remplir
avant mÃªme de toucher au HTML.

CrÃ©er une fonction :
```javascript
function downloadExcelTemplate() {
    // CrÃ©er un Excel vide avec la structure
    const emptyData = {
        clientName: '',
        projectName: '',
        contactDate: '',
        contactPerson: '',
        fields: {}
    };

    // GÃ©nÃ©rer tous les champs vides
    document.querySelectorAll('.question-input').forEach(input => {
        emptyData.fields[input.dataset.field] = '';
    });

    // Exporter comme d'habitude
    exportToExcel(emptyData);
}
```

Ajouter un bouton :
```html
<button class="btn-import" onclick="downloadExcelTemplate()">ğŸ“¥ TÃ©lÃ©charger template Excel</button>
```

Utilisation :
1. Client tÃ©lÃ©charge le template vide
2. Client remplit dans Excel
3. Client te renvoie l'Excel
4. Tu importes dans le HTML


7.4. Export multi-projets
--------------------------
Fonction pour consolider plusieurs projets dans un seul Excel.

```javascript
function exportMultiProjects() {
    // Suppose que tu as plusieurs exports JSON de diffÃ©rents projets
    const projects = [
        JSON.parse(localStorage.getItem('project1')),
        JSON.parse(localStorage.getItem('project2')),
        // ...
    ];

    const workbook = XLSX.utils.book_new();

    // Un onglet par projet
    projects.forEach((project, index) => {
        const projectData = convertProjectToArray(project);
        const ws = XLSX.utils.aoa_to_sheet(projectData);
        XLSX.utils.book_append_sheet(workbook, ws, `Projet_${index + 1}`);
    });

    // Onglet rÃ©capitulatif
    const summary = createProjectsSummary(projects);
    const wsSummary = XLSX.utils.aoa_to_sheet(summary);
    XLSX.utils.book_append_sheet(workbook, wsSummary, "RÃ©capitulatif");

    XLSX.writeFile(workbook, `tous-projets-${Date.now()}.xlsx`);
}
```

================================================================================
ANNEXES
================================================================================

Annexe A : Structure complÃ¨te du fichier Excel
-----------------------------------------------

ONGLET "MÃ©tadonnÃ©es" :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Champ                    â”‚ Valeur                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Date d'export            â”‚ 14/11/2025 15:30:00    â”‚
â”‚ Version questionnaire    â”‚ 1.0                    â”‚
â”‚ Nom du fichier HTML      â”‚ composer-client...html â”‚
â”‚ Nombre total de champs   â”‚ 46                     â”‚
â”‚ Champs remplis           â”‚ 28                     â”‚
â”‚ Pourcentage progression  â”‚ 61%                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ONGLET "Infos_Projet" :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Champ                    â”‚ Valeur                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nom du client / SociÃ©tÃ©  â”‚ Productions XYZ        â”‚
â”‚ Nom du projet            â”‚ Court-mÃ©trage ABC      â”‚
â”‚ Date du premier contact  â”‚ 2025-11-14             â”‚
â”‚ Personne de contact      â”‚ Jean Dupont            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ONGLET "Questionnaire" :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Section         â”‚ Question         â”‚ RÃ©ponse  â”‚ ID Tech    â”‚ Date Modif â”‚ Statut â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ Infos gÃ©n... â”‚ Type de projet   â”‚ Fiction  â”‚ project... â”‚ 2025-11-14 â”‚        â”‚
â”‚ ğŸ“‹ Infos gÃ©n... â”‚ DurÃ©e totale     â”‚ 12 min   â”‚ project... â”‚ 2025-11-14 â”‚        â”‚
â”‚ ...             â”‚ ...              â”‚ ...      â”‚ ...        â”‚ ...        â”‚ ...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(46 lignes total)

ONGLET "Progression" :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Section                 â”‚ ComplÃ©tÃ©sâ”‚ Total â”‚ Pourcentage  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ Infos gÃ©nÃ©rales      â”‚ 5        â”‚ 5     â”‚ 100%         â”‚
â”‚ ğŸ’° Budget               â”‚ 3        â”‚ 5     â”‚ 60%          â”‚
â”‚ ğŸ¼ Besoins musicaux     â”‚ 7        â”‚ 7     â”‚ 100%         â”‚
â”‚ ğŸ“… Planning             â”‚ 2        â”‚ 5     â”‚ 40%          â”‚
â”‚ ğŸ§ Aspects techniques   â”‚ 4        â”‚ 6     â”‚ 67%          â”‚
â”‚ âš–ï¸ Droits juridiques    â”‚ 2        â”‚ 6     â”‚ 33%          â”‚
â”‚ ğŸ¤ Collaboration        â”‚ 3        â”‚ 6     â”‚ 50%          â”‚
â”‚ â• ComplÃ©mentaires      â”‚ 2        â”‚ 6     â”‚ 33%          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                   â”‚ 28       â”‚ 46    â”‚ 61%          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ONGLET "Historique" :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Date/Heure       â”‚ Champ        â”‚ Action       â”‚ Anc. valeur  â”‚ Nouv. valeur â”‚ Source â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 14/11/25 10:30   â”‚ Budget       â”‚ Ajout        â”‚              â”‚ 5000â‚¬        â”‚ HTML   â”‚
â”‚ 15/11/25 14:20   â”‚ Budget       â”‚ Modification â”‚ 5000â‚¬        â”‚ 7000â‚¬        â”‚ EXCEL  â”‚
â”‚ 16/11/25 09:15   â”‚ Planning     â”‚ Ajout        â”‚              â”‚ 01/03/2026   â”‚ HTML   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Annexe B : Correspondance complÃ¨te champs HTML â†” Excel
-------------------------------------------------------

Infos projet :
- client-name        â†’ "Nom du client / SociÃ©tÃ©"
- project-name       â†’ "Nom du projet"
- contact-date       â†’ "Date du premier contact"
- contact-person     â†’ "Personne de contact"

Section 1 : Informations gÃ©nÃ©rales (5 champs)
- project-type       â†’ "Type de projet"
- project-duration   â†’ "DurÃ©e totale du projet"
- synopsis           â†’ "Synopsis ou description"
- target-audience    â†’ "Public cible"
- platforms          â†’ "Plateforme(s) de diffusion"

Section 2 : Aspects financiers (5 champs)
- budget-total       â†’ "Budget total allouÃ© Ã  la musique"
- payment-mode       â†’ "Mode de rÃ©munÃ©ration"
- payment-terms      â†’ "ModalitÃ©s de paiement"
- musicians-budget   â†’ "Budget pour musiciens additionnels"
- additional-costs   â†’ "Frais annexes"

Section 3 : Besoins musicaux (7 champs)
- music-duration     â†’ "DurÃ©e totale de musique dÃ©sirÃ©e"
- themes-count       â†’ "Nombre de thÃ¨mes/morceaux"
- music-style        â†’ "Style(s) musical(aux)"
- references         â†’ "RÃ©fÃ©rences musicales"
- instrumentation    â†’ "Instrumentation souhaitÃ©e"
- diegetic-music     â†’ "Besoins en musique diÃ©gÃ©tique"
- variations         â†’ "NÃ©cessitÃ© de variations"

Section 4 : Planning (5 champs)
- start-date         â†’ "Date de dÃ©but du projet"
- deadline           â†’ "Date de livraison finale"
- milestones         â†’ "Ã‰tapes intermÃ©diaires"
- availability       â†’ "DisponibilitÃ© pour sessions"
- flexibility        â†’ "FlexibilitÃ© du planning"

Section 5 : Aspects techniques (6 champs)
- sound-engineer     â†’ "IngÃ©nieur du son dÃ©diÃ©"
- delivery-format    â†’ "Format de livraison"
- stems              â†’ "Livraison en stems"
- broadcast-standardsâ†’ "Normes de diffusion"
- sync-needs         â†’ "Synchronisation avec l'image"
- video-format       â†’ "Format vidÃ©o"

Section 6 : Droits juridiques (6 champs)
- sacem              â†’ "DÃ©pÃ´t SACEM"
- rights-transfer    â†’ "Cession de droits"
- exploitation-rightsâ†’ "Droits d'exploitation"
- credits            â†’ "CrÃ©dit au gÃ©nÃ©rique"
- portfolio-use      â†’ "Utilisation pour portfolio"
- contract           â†’ "Contrat Ã  Ã©tablir"

Section 7 : Collaboration (6 champs)
- main-contact       â†’ "Interlocuteur principal"
- validation-process â†’ "Processus de validation"
- revisions          â†’ "Nombre de rÃ©visions"
- communication      â†’ "Mode de communication"
- progress-meetings  â†’ "FrÃ©quence des points"
- recording-sessions â†’ "PrÃ©sence aux enregistrements"

Section 8 : ComplÃ©mentaires (6 champs)
- temp-track         â†’ "Musique temporaire"
- constraints        â†’ "Contraintes crÃ©atives"
- future-needs       â†’ "Besoins futurs"
- access-materials   â†’ "AccÃ¨s aux rushes"
- billing-info       â†’ "CoordonnÃ©es facturation"
- additional-notes   â†’ "Notes supplÃ©mentaires"

TOTAL : 4 + 42 = 46 champs


Annexe C : Exemples de code complets
-------------------------------------

Voir les sections 2.1 Ã  3.4 pour les codes dÃ©taillÃ©s de :
- exportToExcel()
- importFromExcel()
- parseExcelData()
- applyImportedData()


Annexe D : DÃ©pannage et problÃ¨mes courants
-------------------------------------------

ProblÃ¨me : "SheetJS is not defined"
Solution : VÃ©rifier que la balise <script> CDN est bien prÃ©sente avant le code

ProblÃ¨me : "Cannot read property 'Sheets' of undefined"
Solution : Le fichier Excel est corrompu ou vide, ajouter validation

ProblÃ¨me : Les caractÃ¨res accentuÃ©s s'affichent mal
Solution : S'assurer que XLSX.writeFile utilise l'encoding UTF-8

ProblÃ¨me : L'import ne fonctionne pas
Solution : VÃ©rifier que les noms d'onglets correspondent exactement

ProblÃ¨me : Les formules Excel ne calculent pas
Solution : Ouvrir le fichier et forcer le recalcul (F9 dans Excel)

ProblÃ¨me : Le fichier est trop gros
Solution : SheetJS gÃ©nÃ¨re des fichiers lÃ©gers (~50 Ko pour ce questionnaire)

================================================================================
CONCLUSION
================================================================================

Cette implÃ©mentation permettra :
âœ… Export HTML â†’ Excel en un clic
âœ… Import Excel â†’ HTML avec gestion des conflits
âœ… Suivi des modifications dans le temps
âœ… Usage fluide sur plusieurs sessions
âœ… Archivage et analyse dans Excel
âœ… Partage facile avec les clients

Temps estimÃ© d'implÃ©mentation : 8-12 heures
ComplexitÃ© technique : Moyenne
Valeur ajoutÃ©e : TrÃ¨s Ã©levÃ©e

Prochaine Ã©tape recommandÃ©e : Commencer par l'Ã‰tape 1 (PrÃ©paration)
